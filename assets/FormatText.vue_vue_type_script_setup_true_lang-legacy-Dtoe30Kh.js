System.register(["./index-legacy-D5-d55UI.js"],function(e,t){"use strict";var r,a,n,s,l,o,c,p,u,g,i,d;return{setters:[e=>{r=e.a,a=e.b,n=e.t,s=e.o,l=e.w,o=e.c,c=e.f,p=e.F,u=e.e,g=e.x,i=e.y,d=e.z}],execute:function(){const t=["一-龥","㐀-䶿","𠀀-𪛟","𪜀-𫜿","𫝀-𫠟","𫠠-𬺯","𬺰-𮯯","𰀀-𱍏","𱍐-𲎯","豈-﫿","︰-﹏"].join(""),f=e=>e.replace(/‘/g,"『").replace(/’/g,"』").replace(/“/g,"「").replace(/”/g,"」"),y=e=>e.trim()?/([。？！」』]|。）|？）|！）)$/.test(e)?e:e+"。":e,m=e=>{const t={"‘":"『","’":"』","“":"「","”":"」","(":"（",")":"）","~":"～",":":"：","?":"？","!":"！",",":"，","<書>":"〈書〉"};return e.replace(/(‘|’|“|”|~|\?|!|<書>)/g,e=>t[e]).replace(/,([^ ])/g,(e,t)=>`，${t}`).replace(/:([^ ])/g,(e,t)=>`：${t}`).replace(/([^\d\\sA-Za-z]|^)\(([^\d\sA-Za-z])/g,(e,r,a)=>`${r}${t["("]}${a}`).replace(/([^\d\\sA-Za-z]|^)\)([^\d\sA-Za-z])/g,(e,r,a)=>`${r}${t[")"]}${a}`)},k=e=>e.replace(new RegExp(`([${t}])([a-zA-Z0-9])`,"gu"),"$1 $2").replace(new RegExp(`([a-zA-Z0-9])([${t}])`,"gu"),"$1 $2"),_=(e("a",e=>k(m(e))),e("c",e=>e.map(e=>`◯${e}`).join("")),{key:0}),$={key:2,class:"toggle-char"},x={key:0};e("_",r({__name:"FormatText",props:{text:{type:String,default:""},glyphMode:{type:String,default:"canonical"},markedClass:{type:[String,Array,Object],default:"after:bg-rosybrown-700"},correctionRules:{type:Array,default:()=>["punctuation","space","stops"]}},setup(e){const t={quotes:f,punctuation:m,space:k,stops:y},r=e,h=a(null),v=n(()=>"original"===r.glyphMode?0:1),A=n(()=>{const e=r.correctionRules.join("|");return`${r.text||""}|${e}`}),M=()=>{const e=r.text?.trim()||"";let t="",a=new Map,n="";if(e){const s=T(e);t=s.protectedText,a=s.tokenMap,n=w(t,r.correctionRules)}return{protectedText:t,tokenMap:a,correctedText:n}};s(()=>{h.value=M()}),l(()=>A.value,()=>{h.value=M()},{immediate:!1,flush:"post"});const w=(e,r=[])=>e&&0!==r.length?r.reduce((e,r)=>{const a=t[r];return a?a(e):e},e):e,b=(e,t)=>`__FORMAT_${t}_${e}__`,T=e=>{const t=new Map;let r=0,a=0,n=e.replace(/([^\s\\])\*/gu,(e,r)=>{const n=b(a++,"marked");return t.set(n,{type:"marked",value:r,raw:e}),n});return n=n.replace(/\{[\s\S]*?\}/gu,e=>{const a=b(r++,"toggle");return t.set(a,{type:"toggle",value:e.slice(1,-1),raw:e}),a}),{protectedText:n,tokenMap:t}},R=n(()=>{if(!r.text?.trim())return[];if(!h.value)return[];const{tokenMap:e,correctedText:t}=h.value,a=((e,t)=>{const r=[];let a=0;if(t.replace(/__FORMAT_(toggle|marked)_\d+__/gu,(n,s,l)=>{if(l>a){const e=t.slice(a,l);e&&r.push({type:"text",content:e})}const o=e.get(n);if(o)if("toggle"===o.type){const t=o.value.split(",").map(e=>e.trim()),a=t.length>=2?t.slice(0,2):[...t,""],n=a.map(t=>((e,t)=>{const r=[];let a=0;if(e.replace(/__FORMAT_marked_\d+__/gu,(n,s)=>{if(s>a){const t=e.slice(a,s);t&&r.push({type:"text",content:t})}const l=t.get(n);return l&&"marked"===l.type&&r.push({type:"marked",content:l.value}),a=s+n.length,n}),a<e.length){const t=e.slice(a);t&&r.push({type:"text",content:t})}return r})(t,e));r.push({type:"toggle",options:a,resolvedOptions:n})}else"marked"===o.type&&r.push({type:"marked",content:o.value});return a=l+n.length,n}),a<t.length){const e=t.slice(a);e&&r.push({type:"text",content:e})}return r})(e,t);return a});return(t,r)=>(c(!0),o(p,null,u(R.value,(t,r)=>(c(),o(p,{key:`node_${r}_${t.type}`},["text"===t.type?(c(),o("span",_,i(t.content),1)):"marked"===t.type?(c(),o("span",{key:1,class:d(["marked-char relative after:absolute after:-bottom-[0.1em] after:left-1/2 after:h-[0.2em] after:w-[0.2em] after:-translate-x-1/2 after:rounded-full after:content-['']",e.markedClass])},i(t.content),3)):"toggle"===t.type?(c(),o("span",$,[(c(!0),o(p,null,u(t.resolvedOptions[v.value],(t,a)=>(c(),o(p,{key:`sub_${r}_${a}_${t.type}`},["text"===t.type?(c(),o("span",x,i(t.content),1)):"marked"===t.type?(c(),o("span",{key:1,class:d(["marked-char relative after:absolute after:-bottom-[0.1em] after:left-1/2 after:h-[0.2em] after:w-[0.2em] after:-translate-x-1/2 after:rounded-full after:content-['']",e.markedClass])},i(t.content),3)):g("",!0)],64))),128))])):g("",!0)],64))),128))}}))}}});
