var K=Object.defineProperty;var Q=(o,t,e)=>t in o?K(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var x=(o,t,e)=>Q(o,typeof t!="symbol"?t+"":t,e);import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as C,b as S,e as m,y as Z,h as ee,w as te,i as oe,p as re,z as g,A as B,B as se,l as L,C as T,D as p,E as ne,G as le,u as V,H as q,I as J,J as U,K as ie,d as ae,r as H,o as ce,g as ue,L as I,v as $,M as E,N as de,F as fe,a as he,O as j,P as ve,t as me}from"./index-xlU6_KyA.js";const pe={},we={class:"flex h-full flex-row justify-between rounded-lg bg-white"},ye={class:"hover:bg-wheat-50 text-rosybrown-600 hover:text-rosybrown-800 m-1 content-center rounded-xs px-3 py-1.5 font-bold transition-all ease-in-out"};function be(o,t){const e=oe("RouterLink");return S(),C("div",we,[m("div",ye,[ee(e,{to:{name:"home"}},{default:te(()=>t[0]||(t[0]=[re("主页")])),_:1})]),t[1]||(t[1]=Z('<div class="hover:bg-wheat-50 text-rosybrown-600 hover:text-rosybrown-800 m-1 content-center rounded-xs px-3 py-1.5 font-bold transition-all ease-in-out"><a href="#">入门</a></div><div class="hover:bg-wheat-50 text-rosybrown-600 hover:text-rosybrown-800 m-1 content-center rounded-xs px-3 py-1.5 font-bold transition-all ease-in-out"><a href="#">帮助</a></div><div class="hover:bg-wheat-50 text-rosybrown-600 hover:text-rosybrown-800 m-1 content-center rounded-xs px-3 py-1.5 font-bold transition-all ease-in-out"><a href="#">关于</a></div>',3))])}const De=R(pe,[["render",be]]),Y=se?window:void 0;function W(o){var t;const e=p(o);return(t=e==null?void 0:e.$el)!=null?t:e}function k(...o){const t=[],e=()=>{t.forEach(l=>l()),t.length=0},r=(l,i,c,v)=>(l.addEventListener(i,c,v),()=>l.removeEventListener(i,c,v)),n=L(()=>{const l=T(p(o[0])).filter(i=>i!=null);return l.every(i=>typeof i!="string")?l:void 0}),d=ne(()=>{var l,i;return[(i=(l=n.value)==null?void 0:l.map(c=>W(c)))!=null?i:[Y].filter(c=>c!=null),T(p(n.value?o[1]:o[0])),T(V(n.value?o[2]:o[1])),p(n.value?o[3]:o[2])]},([l,i,c,v])=>{if(e(),!(l!=null&&l.length)||!(i!=null&&i.length)||!(c!=null&&c.length))return;const O=le(v)?{...v}:v;t.push(...l.flatMap(b=>i.flatMap(y=>c.map(_=>r(b,y,_,O)))))},{flush:"post"}),f=()=>{d(),e()};return q(e),f}let A=!1;function F(o,t,e={}){const{window:r=Y,ignore:n=[],capture:d=!0,detectIframe:f=!1,controls:l=!1}=e;if(!r)return l?{stop:g,cancel:g,trigger:g}:g;if(B&&!A){A=!0;const a={passive:!0};Array.from(r.document.body.children).forEach(s=>k(s,"click",g,a)),k(r.document.documentElement,"click",g,a)}let i=!0;const c=a=>p(n).some(s=>{if(typeof s=="string")return Array.from(r.document.querySelectorAll(s)).some(u=>u===a.target||a.composedPath().includes(u));{const u=W(s);return u&&(a.target===u||a.composedPath().includes(u))}});function v(a){const s=p(a);return s&&s.$.subTree.shapeFlag===16}function O(a,s){const u=p(a),h=u.$.subTree&&u.$.subTree.children;return h==null||!Array.isArray(h)?!1:h.some(w=>w.el===s.target||s.composedPath().includes(w.el))}const b=a=>{const s=W(o);if(a.target!=null&&!(!(s instanceof Element)&&v(o)&&O(o,a))&&!(!s||s===a.target||a.composedPath().includes(s))){if("detail"in a&&a.detail===0&&(i=!c(a)),!i){i=!0;return}t(a)}};let y=!1;const _=[k(r,"click",a=>{y||(y=!0,setTimeout(()=>{y=!1},0),b(a))},{passive:!0,capture:d}),k(r,"pointerdown",a=>{const s=W(o);i=!c(a)&&!!(s&&!a.composedPath().includes(s))},{passive:!0}),f&&k(r,"blur",a=>{setTimeout(()=>{var s;const u=W(o);((s=r.document.activeElement)==null?void 0:s.tagName)==="IFRAME"&&!(u!=null&&u.contains(r.document.activeElement))&&t(a)},0)},{passive:!0})].filter(Boolean),N=()=>_.forEach(a=>a());return l?{stop:N,cancel:()=>{i=!1},trigger:a=>{i=!0,b(a),i=!1}}:N}const xe={mounted(o,t){const e=!t.modifiers.bubble;if(typeof t.value=="function")o.__onClickOutside_stop=F(o,t.value,{capture:e});else{const[r,n]=t.value;o.__onClickOutside_stop=F(o,r,Object.assign({capture:e},n))}},unmounted(o){o.__onClickOutside_stop()}};function M(o){return typeof Window<"u"&&o instanceof Window?o.document.documentElement:typeof Document<"u"&&o instanceof Document?o.documentElement:o}function X(o){const t=window.getComputedStyle(o);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&o.clientWidth<o.scrollWidth||t.overflowY==="auto"&&o.clientHeight<o.scrollHeight)return!0;{const e=o.parentNode;return!e||e.tagName==="BODY"?!1:X(e)}}function ge(o){const t=o||window.event,e=t.target;return X(e)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}const P=new WeakMap;function ke(o,t=!1){const e=J(t);let r=null,n="";U(ie(o),l=>{const i=M(p(l));if(i){const c=i;if(P.get(c)||P.set(c,c.style.overflow),c.style.overflow!=="hidden"&&(n=c.style.overflow),c.style.overflow==="hidden")return e.value=!0;if(e.value)return c.style.overflow="hidden"}},{immediate:!0});const d=()=>{const l=M(p(o));!l||e.value||(B&&(r=k(l,"touchmove",i=>{ge(i)},{passive:!1})),l.style.overflow="hidden",e.value=!0)},f=()=>{const l=M(p(o));!l||!e.value||(B&&(r==null||r()),l.style.overflow=n,P.delete(l),e.value=!1)};return q(f),L({get(){return e.value},set(l){l?d():f()}})}function Oe(){let o=!1;const t=J(!1);return(e,r)=>{if(t.value=r.value,o)return;o=!0;const n=ke(e,r.value);U(t,d=>n.value=d)}}Oe();class D{constructor(){x(this,"children");x(this,"isEndOfWord");x(this,"timestamp");this.children={},this.isEndOfWord=!1,this.timestamp=null}}class z{constructor(){x(this,"root");x(this,"size");this.root=new D,this.size=0}clear(){this.root=new D,this.size=0}insert(t){let e=this.root;for(const r of t)e.children[r]||(e.children[r]=new D),e=e.children[r];e.isEndOfWord||this.size++,e.isEndOfWord=!0,e.timestamp=Date.now()}delete(t){const e=(r,n)=>{if(n===t.length)return r.isEndOfWord?(r.isEndOfWord=!1,this.size--,Object.keys(r.children).length===0):!1;const d=t[n],f=r.children[d];return f&&e(f,n+1)?(delete r.children[d],Object.keys(r.children).length===0):!1};e(this.root,0)}findWords(t){let e=this.root;for(const r of t){if(!e.children[r])return[];e=e.children[r]}return this.collectWords(e,t)}collectWords(t,e){const r=[];t.isEndOfWord&&t.timestamp&&r.push({word:e,timestamp:t.timestamp});for(const n in t.children)r.push(...this.collectWords(t.children[n],e+n));return r}serialize(){function t(e){return{isEndOfWord:e.isEndOfWord,timestamp:e.timestamp,children:Object.fromEntries(Object.entries(e.children).map(([r,n])=>[r,t(n)]))}}return JSON.stringify(t(this.root))}static deserialize(t){const e=new z;function r(n){const d=new D;d.isEndOfWord=n.isEndOfWord,d.timestamp=n.timestamp;for(const[f,l]of Object.entries(n.children))d.children[f]=r(l);return d}return e.root=r(JSON.parse(t)),e}}const _e={class:"outline-rosybrown-300 absolute top-full right-0 left-0 rounded-b-md bg-white pt-2 outline"},Ee=["onClick"],Ce={class:"text-rosybrown-600 overflow-hidden text-ellipsis"},Se=["onClick"],We={class:"flex flex-row-reverse items-baseline px-4 py-1"},ze=ae({__name:"SearchBar",setup(o){const t=ve(),e=H(""),r=H([]),n=H(!1),d=H(!1),f=()=>{n.value=!1};ce(()=>{window.addEventListener("scroll",f)}),ue(()=>{window.removeEventListener("scroll",f)});const i=(s=>{try{return s?z.deserialize(s):new z}catch(u){return console.error("反序列化前缀树时出错:",u),new z}})(localStorage.getItem("searchHistory")),c=()=>{const s=e.value;if(s){i.insert(s);try{localStorage.setItem("searchHistory",i.serialize())}finally{e.value=""}}n.value=!1,d.value=!1,t.push({path:"/search",query:{word:s}})},v=()=>{n.value=!0;const s=e.value,u=i.findWords(s);if(u.length<2){r.value=u.map(h=>h.word);return}u.sort((h,w)=>w.timestamp-h.timestamp),r.value=u.map(h=>h.word).slice(0,10)},O=s=>{e.value=r.value[s],c()},b=s=>{i.delete(r.value.splice(s,1)[0]),localStorage.setItem("searchHistory",i.serialize())},y=()=>{r.value=[],i.clear(),localStorage.removeItem("searchHistory")},_=s=>{s.target.tagName==="INPUT"&&(n.value=!0,d.value=!0)},N=L(()=>n.value&&r.value.length>0?["rounded-b-none","rounded-t-[24px]"]:["rounded-[3rem]"]),a=L(()=>n.value?["backdrop-blur-xs","backdrop-brightness-90"]:["hidden"]);return(s,u)=>(S(),C("div",null,[m("div",{class:$(["fixed top-0 left-0 z-50 h-screen w-screen",a.value])},null,2),I((S(),C("form",{class:$(["outline-rosybrown-300 hover:outline-rosybrown-400 relative z-100 flex h-12 flex-row items-center space-x-2 bg-white px-3 outline-2 hover:outline-3",N.value]),onSubmit:E(c,["prevent"]),onClick:_},[m("span",{class:"material-symbols-rounded text-rosybrown-400 hover:text-rosybrown-700 cursor-pointer pl-1",onClick:E(c,["stop"])},"search"),I(m("input",{class:"text-rosybrown-800 h-full w-full","onUpdate:modelValue":u[0]||(u[0]=h=>e.value=h),onInput:v,onFocus:v},null,544),[[de,e.value,void 0,{trim:!0}]]),I(m("ul",_e,[(S(!0),C(fe,null,he(r.value,(h,w)=>(S(),C("li",{key:w,class:"hover:border-l-rosybrown-700 hover:text-rosybrown-700 hover:bg-rosybrown-50 box-border flex flex-row items-center justify-between border-l-3 border-l-transparent px-4 py-1"},[m("div",{class:"flex w-7/8 cursor-pointer flex-row items-center font-sans",onClick:E(G=>O(w),["stop"])},[u[1]||(u[1]=m("span",{class:"material-symbols-rounded text-rosybrown-400 w-fit pr-4",style:{"font-size":"22px"}},"history",-1)),m("div",Ce,me(h),1)],8,Ee),m("div",{class:"text-rosybrown-300 hover:text-rosybrown-500 cursor-pointer text-sm hover:underline",onClick:E(G=>b(w),["stop"])}," 删除 ",8,Se)]))),128)),I(m("li",We,[m("div",{class:"text-rosybrown-300 hover:text-rosybrown-500 cursor-pointer text-xs",onClick:E(y,["stop"])}," 清空历史 ")],512),[[j,n.value&&r.value.length>0]])],512),[[j,n.value&&r.value.length>0]])],34)),[[V(xe),()=>{n.value=!1}]])]))}}),Le=R(ze,[["__scopeId","data-v-9d2509bb"]]);export{De as N,Le as S};
