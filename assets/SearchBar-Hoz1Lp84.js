var E=Object.defineProperty;var C=(n,t,e)=>t in n?E(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var h=(n,t,e)=>C(n,typeof t!="symbol"?t+"":t,e);import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{j as y,l as v,m as a,K as N,y as V,C as j,E as I,G as B,h as D,r as g,c as T,L as b,z as $,A as w,M as F,F as L,k as q,N as _,O as M,v as R}from"./index-BalImF26.js";const J={},A={class:"flex h-full flex-row justify-between rounded-lg bg-white"},G={class:"hover:bg-wheat-50 text-rosybrown-600 hover:text-rosybrown-800 m-1 content-center rounded-xs px-3 py-1.5 font-bold transition-all ease-in-out"};function K(n,t){const e=I("RouterLink");return v(),y("div",A,[a("div",G,[V(e,{to:{name:"home"}},{default:j(()=>t[0]||(t[0]=[B("主页")])),_:1})]),t[1]||(t[1]=N('<div class="hover:bg-wheat-50 text-rosybrown-600 hover:text-rosybrown-800 m-1 content-center rounded-xs px-3 py-1.5 font-bold transition-all ease-in-out"><a href="#">入门</a></div><div class="hover:bg-wheat-50 text-rosybrown-600 hover:text-rosybrown-800 m-1 content-center rounded-xs px-3 py-1.5 font-bold transition-all ease-in-out"><a href="#">帮助</a></div><div class="hover:bg-wheat-50 text-rosybrown-600 hover:text-rosybrown-800 m-1 content-center rounded-xs px-3 py-1.5 font-bold transition-all ease-in-out"><a href="#">关于</a></div>',3))])}const oe=O(J,[["render",K]]);class p{constructor(){h(this,"children");h(this,"isEndOfWord");h(this,"timestamp");this.children={},this.isEndOfWord=!1,this.timestamp=null}}class m{constructor(){h(this,"root");h(this,"size");this.root=new p,this.size=0}clear(){this.root=new p,this.size=0}insert(t){let e=this.root;for(const r of t)e.children[r]||(e.children[r]=new p),e=e.children[r];e.isEndOfWord||this.size++,e.isEndOfWord=!0,e.timestamp=Date.now()}delete(t){const e=(r,o)=>{if(o===t.length)return r.isEndOfWord?(r.isEndOfWord=!1,this.size--,Object.keys(r.children).length===0):!1;const d=t[o],i=r.children[d];return i&&e(i,o+1)?(delete r.children[d],Object.keys(r.children).length===0):!1};e(this.root,0)}findWords(t){let e=this.root;for(const r of t){if(!e.children[r])return[];e=e.children[r]}return this.collectWords(e,t)}collectWords(t,e){const r=[];t.isEndOfWord&&t.timestamp&&r.push({word:e,timestamp:t.timestamp});for(const o in t.children)r.push(...this.collectWords(t.children[o],e+o));return r}serialize(){function t(e){return{isEndOfWord:e.isEndOfWord,timestamp:e.timestamp,children:Object.fromEntries(Object.entries(e.children).map(([r,o])=>[r,t(o)]))}}return JSON.stringify(t(this.root))}static deserialize(t){const e=new m;function r(o){const d=new p;d.isEndOfWord=o.isEndOfWord,d.timestamp=o.timestamp;for(const[i,u]of Object.entries(o.children))d.children[i]=r(u);return d}return e.root=r(JSON.parse(t)),e}}const P={class:"outline-rosybrown-300 absolute top-full right-0 left-0 rounded-b-md bg-white pt-2 outline"},Q=["onClick"],U={class:"text-rosybrown-600 overflow-hidden text-ellipsis"},X=["onClick"],Y={class:"flex flex-row-reverse items-baseline px-4 py-1"},Z=D({__name:"SearchBar",props:{isHistoryVisible:{type:Boolean,default:!1}},setup(n){const t=n,e=M(),r=g(""),o=g([]),i=(s=>{try{return s?m.deserialize(s):new m}catch(l){return console.error("反序列化前缀树时出错:",l),new m}})(localStorage.getItem("searchHistory")),u=()=>{const s=r.value;if(s){i.insert(s);try{localStorage.setItem("searchHistory",i.serialize())}finally{r.value=""}}e.push({path:"/search",query:{word:s}})},x=()=>{const s=r.value,l=i.findWords(s);if(l.length<2){o.value=l.map(c=>c.word);return}l.sort((c,f)=>f.timestamp-c.timestamp),o.value=l.map(c=>c.word).slice(0,10)},z=s=>{r.value=o.value[s],u()},H=s=>{i.delete(o.value.splice(s,1)[0]),localStorage.setItem("searchHistory",i.serialize())},W=()=>{o.value=[],i.clear(),localStorage.removeItem("searchHistory")},S=T(()=>t.isHistoryVisible&&o.value.length>0?["rounded-b-none","rounded-t-[24px]"]:["rounded-[3rem]"]);return(s,l)=>(v(),y("form",{onSubmit:b(u,["prevent"])},[a("div",{class:$(["outline-rosybrown-300 hover:outline-rosybrown-400 flex h-12 flex-row items-center space-x-2 bg-white px-3 outline-2 hover:outline-3",S.value])},[a("span",{class:"material-symbols-rounded text-rosybrown-400 hover:text-rosybrown-700 cursor-pointer pl-1",onClick:u},"search"),w(a("input",{class:"text-rosybrown-800 h-full w-full","onUpdate:modelValue":l[0]||(l[0]=c=>r.value=c),onInput:x,onFocus:x},null,544),[[F,r.value,void 0,{trim:!0}]]),w(a("ul",P,[(v(!0),y(L,null,q(o.value,(c,f)=>(v(),y("li",{key:f,class:"hover:border-l-rosybrown-700 hover:text-rosybrown-700 hover:bg-rosybrown-50 box-border flex flex-row items-center justify-between border-l-3 border-l-transparent px-4 py-1"},[a("div",{class:"flex w-7/8 cursor-pointer flex-row items-center font-sans",onClick:k=>z(f)},[l[1]||(l[1]=a("span",{class:"material-symbols-rounded text-rosybrown-400 w-fit pr-4",style:{"font-size":"22px"}},"history",-1)),a("div",U,R(c),1)],8,Q),a("div",{class:"text-rosybrown-300 hover:text-rosybrown-500 cursor-pointer text-sm hover:underline",onClick:b(k=>H(f),["stop"])}," 删除 ",8,X)]))),128)),w(a("li",Y,[a("div",{class:"text-rosybrown-300 hover:text-rosybrown-500 cursor-pointer text-xs",onClick:b(W,["stop"])}," 清空历史 ")],512),[[_,n.isHistoryVisible&&o.value.length>0]])],512),[[_,n.isHistoryVisible&&o.value.length>0]])],2)],32))}}),se=O(Z,[["__scopeId","data-v-d22127d1"]]);export{oe as N,se as S};
