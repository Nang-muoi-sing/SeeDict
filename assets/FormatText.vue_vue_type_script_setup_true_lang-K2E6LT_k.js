import{a as j,b as P,t as $,o as D,w as V,c as i,f as d,F as _,e as w,x as M,y as h,z as A}from"./index-NWfRUO80.js";const R=["一-龥","㐀-䶿","𠀀-𪛟","𪜀-𫜿","𫝀-𫠟","𫠠-𬺯","𬺰-𮯯","𰀀-𱍏","𱍐-𲎯","豈-﫿","︰-﹏"].join(""),B=o=>o.replace(/‘/g,"『").replace(/’/g,"』").replace(/“/g,"「").replace(/”/g,"」"),K=o=>o.trim()?/([。？！」』]|。）|？）|！）)$/.test(o)?o:o+"。":o,C=o=>{const g={"‘":"『","’":"』","“":"「","”":"」","(":"（",")":"）","~":"～",":":"：","?":"？","!":"！",",":"，","<書>":"〈書〉"};return o.replace(/(‘|’|“|”|~|\?|!|<書>)/g,c=>g[c]).replace(/,([^ ])/g,(c,l)=>"，".concat(l)).replace(/:([^ ])/g,(c,l)=>"：".concat(l)).replace(/([^\d\\sA-Za-z]|^)\(([^\d\sA-Za-z])/g,(c,l,y)=>"".concat(l).concat(g["("]).concat(y)).replace(/([^\d\\sA-Za-z]|^)\)([^\d\sA-Za-z])/g,(c,l,y)=>"".concat(l).concat(g[")"]).concat(y))},S=o=>o.replace(new RegExp("([".concat(R,"])([a-zA-Z0-9])"),"gu"),"$1 $2").replace(new RegExp("([a-zA-Z0-9])([".concat(R,"])"),"gu"),"$1 $2"),L=o=>S(C(o)),N=o=>o.map(g=>"◯".concat(g)).join(""),W={key:0},q={key:2,class:"toggle-char"},G={key:0},Q=j({__name:"FormatText",props:{text:{type:String,default:""},glyphMode:{type:String,default:"canonical"},markedClass:{type:[String,Array,Object],default:"after:bg-rosybrown-700"},correctionRules:{type:Array,default:()=>["punctuation","space","stops"]}},setup(o){const g={quotes:B,punctuation:C,space:S,stops:K},c=o,l=P(null),y=$(()=>c.glyphMode==="original"?0:1),z=$(()=>{const n=c.correctionRules.join("|");return"".concat(c.text||"","|").concat(n)}),x=()=>{var e;const n=((e=c.text)==null?void 0:e.trim())||"";let a="",t=new Map,s="";if(n){const r=E(n);a=r.protectedText,t=r.tokenMap,s=F(a,c.correctionRules)}return{protectedText:a,tokenMap:t,correctedText:s}};D(()=>{l.value=x()}),V(()=>z.value,()=>{l.value=x()},{immediate:!1,flush:"post"});const F=(n,a=[])=>!n||a.length===0?n:a.reduce((t,s)=>{const e=g[s];return e?e(t):t},n),T=(n,a)=>"__FORMAT_".concat(a,"_").concat(n,"__"),E=n=>{const a=new Map;let t=0,s=0,e=n.replace(/([^\s\\])\*/gu,(r,u)=>{const p=T(s++,"marked");return a.set(p,{type:"marked",value:u,raw:r}),p});return e=e.replace(/\{[\s\S]*?\}/gu,r=>{const u=T(t++,"toggle");return a.set(u,{type:"toggle",value:r.slice(1,-1),raw:r}),u}),{protectedText:e,tokenMap:a}},O=(n,a)=>{const t=[],s=/__FORMAT_marked_\d+__/gu;let e=0;if(n.replace(s,(r,u)=>{if(u>e){const f=n.slice(e,u);f&&t.push({type:"text",content:f})}const p=a.get(r);return p&&p.type==="marked"&&t.push({type:"marked",content:p.value}),e=u+r.length,r}),e<n.length){const r=n.slice(e);r&&t.push({type:"text",content:r})}return t},I=(n,a)=>{const t=[],s=/__FORMAT_(toggle|marked)_\d+__/gu;let e=0;if(a.replace(s,(r,u,p)=>{if(p>e){const m=a.slice(e,p);m&&t.push({type:"text",content:m})}const f=n.get(r);if(f)if(f.type==="toggle"){const m=f.value.split(",").map(k=>k.trim()),v=m.length>=2?m.slice(0,2):[...m,""],b=v.map(k=>O(k,n));t.push({type:"toggle",options:v,resolvedOptions:b})}else f.type==="marked"&&t.push({type:"marked",content:f.value});return e=p+r.length,r}),e<a.length){const r=a.slice(e);r&&t.push({type:"text",content:r})}return t},Z=$(()=>{var e;if(!(((e=c.text)==null?void 0:e.trim())||""))return[];if(!l.value)return[];const{tokenMap:a,correctedText:t}=l.value;return I(a,t)});return(n,a)=>(d(!0),i(_,null,w(Z.value,(t,s)=>(d(),i(_,{key:"node_".concat(s,"_").concat(t.type)},[t.type==="text"?(d(),i("span",W,h(t.content),1)):t.type==="marked"?(d(),i("span",{key:1,class:A(["marked-char relative after:absolute after:-bottom-[0.1em] after:left-1/2 after:h-[0.2em] after:w-[0.2em] after:-translate-x-1/2 after:rounded-full after:content-['']",o.markedClass])},h(t.content),3)):t.type==="toggle"?(d(),i("span",q,[(d(!0),i(_,null,w(t.resolvedOptions[y.value],(e,r)=>(d(),i(_,{key:"sub_".concat(s,"_").concat(r,"_").concat(e.type)},[e.type==="text"?(d(),i("span",G,h(e.content),1)):e.type==="marked"?(d(),i("span",{key:1,class:A(["marked-char relative after:absolute after:-bottom-[0.1em] after:left-1/2 after:h-[0.2em] after:w-[0.2em] after:-translate-x-1/2 after:rounded-full after:content-['']",o.markedClass])},h(e.content),3)):M("",!0)],64))),128))])):M("",!0)],64))),128))}});export{Q as _,L as a,N as c};
